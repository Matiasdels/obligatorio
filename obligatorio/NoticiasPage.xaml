<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             x:Class="obligatorio.NoticiasPage" 
             Title="Últimas Noticias"
             BackgroundColor="{StaticResource OxfordBlue}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="NewsDateLabel" TargetType="Label">
                <Setter Property="TextColor" Value="#FCD34D"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="Margin" Value="0,5,0,0"/>
            </Style>

            <Style x:Key="NewsTitleLabel" TargetType="Label">
                <Setter Property="TextColor" Value="{StaticResource White}"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="LineBreakMode" Value="WordWrap"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
            </Style>

            <Style x:Key="NewsDescriptionLabel" TargetType="Label">
                <Setter Property="TextColor" Value="#E5E7EB"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="LineBreakMode" Value="WordWrap"/>
                <Setter Property="MaxLines" Value="3"/>
                <Setter Property="Margin" Value="0,0,0,10"/>
            </Style>

            <Style x:Key="NewsSourceLabel" TargetType="Label">
                <Setter Property="TextColor" Value="#9CA3AF"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="FontAttributes" Value="Italic"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
            </Style>

            <Style x:Key="NewsImageFrame" TargetType="Frame">
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="HasShadow" Value="False"/>
                <Setter Property="Padding" Value="0"/>
                <Setter Property="BackgroundColor" Value="Transparent"/>
                <Setter Property="HeightRequest" Value="180"/>
                <Setter Property="Margin" Value="0,0,0,12"/>
            </Style>

            <Style x:Key="NewsCardFrame" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="#1F2937"/>
                <Setter Property="CornerRadius" Value="16"/>
                <Setter Property="HasShadow" Value="True"/>
                <Setter Property="Padding" Value="16"/>
                <Setter Property="Margin" Value="8,6"/>
            </Style>

            <Style x:Key="ReadMoreButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#3B82F6"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="CornerRadius" Value="20"/>
                <Setter Property="HeightRequest" Value="36"/>
                <Setter Property="Padding" Value="16,8"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>


        <Frame x:Name="HeaderFrame"
       BackgroundColor="Transparent" 
       Background="{StaticResource PrimaryGradient}" 
       CornerRadius="20" 
       Padding="25" 
       Shadow="{StaticResource CardShadow}">
            <Frame.GestureRecognizers>
                <PointerGestureRecognizer PointerEntered="OnHeaderPointerEntered" 
                                          PointerExited="OnHeaderPointerExited"/>
            </Frame.GestureRecognizers>
            <VerticalStackLayout Spacing="8">
                <Label Text="📰 Últimas Noticias" 
                       FontSize="28" 
                       FontAttributes="Bold" 
                       TextColor="White" 
                       HorizontalOptions="Center"/>
                <Label Text="Mantente informado con lo más reciente" 
                       FontSize="16" 
                       TextColor="White" 
                       Opacity="0.9" 
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </Frame>


        <Frame Grid.Row="1" 
               Style="{StaticResource AppCardFrame}"
               CornerRadius="20"
               Margin="20,15,20,10"
               Padding="5">
            <SearchBar x:Name="NewsSearchBar"
                       Placeholder="🔍 Buscar noticias..."
                       Style="{StaticResource AppSearchBar}"
                       TextChanged="OnNewsSearchTextChanged"/>
        </Frame>


        <CollectionView x:Name="NewsCollection"
                Grid.Row="2"
                ItemsSource="{Binding NoticiasFiltradas}"
                Margin="10"
                ItemSizingStrategy="MeasureAllItems">

            <!-- Configuración del Grid Layout -->
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" 
                        Span="2" 
                        HorizontalItemSpacing="10"
                        VerticalItemSpacing="10"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Style="{StaticResource NewsCardFrame}">
                        <StackLayout Spacing="8">

                            <!-- Frame de imagen más compacto -->
                            <Frame Style="{StaticResource NewsImageFrame}" 
                           BackgroundColor="#374151"
                           HeightRequest="120">
                                <Grid>
                                    <!-- Imagen real -->
                                    <Image Source="{Binding ImageUrl}" 
                                   Aspect="AspectFill"
                                   IsVisible="{Binding HasImage}"/>

                                    <!-- Placeholder -->
                                    <StackLayout VerticalOptions="Center" 
                                       HorizontalOptions="Center"
                                       IsVisible="{Binding HasImage, Converter={StaticResource InverseBoolConverter}}">
                                        <Label Text="📰" 
                                       FontSize="24" 
                                       TextColor="#9CA3AF"
                                       HorizontalOptions="Center"/>
                                        <Label Text="{Binding SourceId}" 
                                       FontSize="10" 
                                       TextColor="#6B7280"
                                       HorizontalOptions="Center"
                                       LineBreakMode="TailTruncation"/>
                                    </StackLayout>
                                </Grid>
                            </Frame>

                            <!-- Contenido más compacto -->
                            <StackLayout Spacing="6">
                                <Label Text="{Binding Title}" 
                               Style="{StaticResource NewsTitleLabel}"
                               MaxLines="2"
                               LineBreakMode="TailTruncation"/>

                                <Label Text="{Binding Description}" 
                               Style="{StaticResource NewsDescriptionLabel}"
                               MaxLines="3"
                               LineBreakMode="TailTruncation"/>

                                <Button Text="📖 Leer más" 
                                Style="{StaticResource ReadMoreButton}"
                                FontSize="12"
                                Clicked="OnReadMoreClicked"/>
                            </StackLayout>
                        </StackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Grid.Row="3"
                x:Name="btnAtras" 
                Text="← Volver atrás" 
                Clicked="btnNoticiasAtras_Clicked"
                Style="{StaticResource AppPrimaryButton}"
                HeightRequest="45"
                Margin="20,10,20,15"/>
    </Grid>
</ContentPage>