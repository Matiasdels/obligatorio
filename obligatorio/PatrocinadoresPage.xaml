<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="obligatorio.PatrocinadoresPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             Title="Patrocinadores"
             BackgroundColor="{StaticResource OxfordBlue}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Header Frame con el mismo estilo que Clima -->
            <Frame x:Name="HeaderFrame"
                   BackgroundColor="Transparent" 
                   Background="{StaticResource PrimaryGradient}" 
                   CornerRadius="20" 
                   Padding="25" 
                   Shadow="{StaticResource CardShadow}">
                <Frame.GestureRecognizers>
                    <PointerGestureRecognizer PointerEntered="OnHeaderPointerEntered" 
                                            PointerExited="OnHeaderPointerExited"/>
                </Frame.GestureRecognizers>
                <VerticalStackLayout Spacing="8">
                    <Label Text="🏢 Patrocinadores" 
                           FontSize="28" 
                           FontAttributes="Bold" 
                           TextColor="White" 
                           HorizontalOptions="Center"/>
                    <Label Text="Nuestros valiosos colaboradores" 
                           FontSize="16" 
                           TextColor="White" 
                           Opacity="0.9" 
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Botón Gestionar con el estilo de Clima -->
            <Button x:Name="BtnGestionar"
                    Text="⚙️ Gestionar"
                    Style="{StaticResource AppSecondaryButton}"
                    HeightRequest="45"
                    Margin="0,0,0,10"
                    Clicked="OnGestionarClicked" />

            <!-- Frame principal para la lista de patrocinadores -->
            <Frame BackgroundColor="{StaticResource PrussianBlue}"
                   CornerRadius="20"
                   HasShadow="True"
                   Padding="20"
                   HorizontalOptions="Fill">

                <VerticalStackLayout Spacing="15">

                    <!-- Loading Layout -->
                    <StackLayout x:Name="LoadingLayout" 
                                IsVisible="{Binding IsLoading}"
                                VerticalOptions="CenterAndExpand"
                                HorizontalOptions="CenterAndExpand">
                        <ActivityIndicator IsRunning="{Binding IsLoading}"
                                         Color="{StaticResource White}"
                                         Scale="1.5" />
                        <Label Text="Cargando patrocinadores..."
                               FontSize="16"
                               TextColor="{StaticResource White}"
                               HorizontalOptions="Center"
                               Margin="0,20,0,0" />
                    </StackLayout>

                    <!-- Título de la sección -->
                    <Label Text="Lista de Patrocinadores"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="{StaticResource White}"
                           HorizontalOptions="Center"
                           IsVisible="{Binding IsNotLoading}"/>

                    <!-- RefreshView y CollectionView -->
                    <RefreshView x:Name="RefreshView"
                                IsRefreshing="{Binding IsRefreshing}"
                                RefreshColor="{StaticResource White}"
                                Refreshing="OnRefreshing"
                                IsVisible="{Binding IsNotLoading}">

                        <CollectionView x:Name="PatrocinadoresCollection"
                                       ItemsSource="{Binding Patrocinadores}"
                                       SelectionMode="None"
                                       VerticalOptions="FillAndExpand">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Vertical" ItemSpacing="5" />
                            </CollectionView.ItemsLayout>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <!-- Container con margin para dar espacio al hover effect -->
                                    <Grid Margin="5,8">
                                        <Frame BackgroundColor="{StaticResource Gray100}"
                                               CornerRadius="8"
                                               Padding="12"
                                               Margin="0"
                                               HasShadow="False"
                                               HorizontalOptions="Fill"
                                               HeightRequest="70">

                                            <Frame.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnPatrocinadorTapped" />
                                                <PointerGestureRecognizer PointerEntered="OnPatrocinadorPointerEntered"
                                                                          PointerExited="OnPatrocinadorPointerExited"/>
                                            </Frame.GestureRecognizers>

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="50" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Icono del patrocinador -->
                                                <Frame Grid.Column="0"
                                                       BackgroundColor="{StaticResource PrussianBlue}"
                                                       CornerRadius="25"
                                                       WidthRequest="45"
                                                       HeightRequest="45"
                                                       HasShadow="False"
                                                       Padding="0"
                                                       VerticalOptions="Center">
                                                    <Label Text="🏢"
                                                           FontSize="18"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center" />
                                                </Frame>

                                                <!-- Información del patrocinador -->
                                                <StackLayout Grid.Column="1"
                                                            Margin="12,0,0,0"
                                                            VerticalOptions="Center">
                                                    <Label Text="{Binding Nombre}"
                                                           FontSize="15"
                                                           FontAttributes="Bold"
                                                           TextColor="{StaticResource PrussianBlue}"
                                                           LineBreakMode="TailTruncation" />
                                                    <Label Text="{Binding Direccion}"
                                                           FontSize="12"
                                                           TextColor="{StaticResource Gray600}"
                                                           LineBreakMode="TailTruncation"
                                                           Margin="0,2,0,0" />
                                                </StackLayout>

                                                <!-- Icono de ubicación -->
                                                <Label Grid.Column="2"
                                                       Text="📍"
                                                       FontSize="18"
                                                       VerticalOptions="Center"
                                                       HorizontalOptions="Center"
                                                       Margin="0,0,8,0" />
                                            </Grid>
                                        </Frame>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>

                            <!-- Empty View -->
                            <CollectionView.EmptyView>
                                <StackLayout HorizontalOptions="CenterAndExpand"
                                            VerticalOptions="CenterAndExpand"
                                            Margin="20">
                                    <Label Text="📭"
                                           FontSize="48"
                                           HorizontalOptions="Center" />
                                    <Label Text="No hay patrocinadores disponibles"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource White}"
                                           HorizontalOptions="Center"
                                           Margin="0,20,0,0" />
                                    <Label Text="Toca 'Gestionar' para agregar patrocinadores"
                                           FontSize="14"
                                           TextColor="{StaticResource White}"
                                           Opacity="0.8"
                                           HorizontalOptions="Center"
                                           HorizontalTextAlignment="Center"
                                           Margin="0,10,0,0" />
                                </StackLayout>
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </RefreshView>
                </VerticalStackLayout>
            </Frame>

            <!-- Botón Agregar con estilo flotante similar al de clima -->
            <Button x:Name="BtnAdd"
                    Text="+ Agregar"
                    Style="{StaticResource AppPrimaryButton}"
                    HeightRequest="45"
                    Margin="0,10,0,0"
                    Clicked="OnAgregarPatrocinadorClicked" />

            <!-- Botón Volver -->
            <Button x:Name="btnAtras" 
                    Text="← Volver atrás" 
                    Clicked="btnAtras_Clicked"
                    Style="{StaticResource AppPrimaryButton}"
                    HeightRequest="45"
                    Margin="0,10,0,15"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>