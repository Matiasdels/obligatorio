<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="obligatorio.PatrocinadoresPage"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
                Title="PatrocinadoresPage"
             BackgroundColor="#f8f9fa">


    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Gradiente azul principal -->
            <LinearGradientBrush x:Key="BlueGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#2196F3" Offset="0.0" />
                <GradientStop Color="#1976D2" Offset="1.0" />
            </LinearGradientBrush>

            <!-- Gradiente azul suave -->
            <LinearGradientBrush x:Key="SoftBlueGradient" StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#E3F2FD" Offset="0.0" />
                <GradientStop Color="#BBDEFB" Offset="1.0" />
            </LinearGradientBrush>

            <!-- Estilo para tarjetas de patrocinadores -->
            <Style x:Key="PatrocinadorCard" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="White" />
                <Setter Property="CornerRadius" Value="20" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="Margin" Value="8" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="BorderColor" Value="#E0E0E0" />
            </Style>

            <!-- Estilo para botones principales -->
            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="Background" Value="{StaticResource BlueGradient}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="CornerRadius" Value="25" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="Padding" Value="20,12" />
                <Setter Property="Margin" Value="5" />
            </Style>

            
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Frame Grid.Row="0" 
               Background="{StaticResource BlueGradient}"
               CornerRadius="0,0,20,20"
               HasShadow="True"
               Margin="0,0,0,10">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0"
                       Text="Nuestros Patrocinadores"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center"
                       Margin="20,0" />

                <Button Grid.Column="1"
                        x:Name="BtnGestionar"
                        Text="âš™ï¸ Gestionar"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="14"
                        CornerRadius="20"
                        BorderColor="White"
                        BorderWidth="2"
                        Padding="15,8"
                        Margin="0,0,20,0"
                        Clicked="OnGestionarClicked" />
            </Grid>
        </Frame>

        <!-- Lista de patrocinadores en tarjetas responsivas -->
        <RefreshView Grid.Row="1" 
                     x:Name="RefreshView"
                     IsRefreshing="{Binding IsRefreshing}"
                     RefreshColor="#2196F3"
                     Refreshing="OnRefreshing">

            <ScrollView>
                <Grid>
                    <!-- Loading Layout -->
                    <StackLayout x:Name="LoadingLayout" 
                                IsVisible="{Binding IsLoading}"
                                VerticalOptions="CenterAndExpand"
                                HorizontalOptions="CenterAndExpand">
                        <ActivityIndicator IsRunning="{Binding IsLoading}"
                                         Color="#2196F3"
                                         Scale="1.5" />
                        <Label Text="Cargando patrocinadores..."
                               FontSize="16"
                               TextColor="{StaticResource White}"
                               HorizontalOptions="Center"
                               Margin="0,20,0,0" />
                    </StackLayout>

                    <!-- Collection View con layout de cuadrÃ­cula -->
                    <CollectionView x:Name="PatrocinadoresCollection"
                                   ItemsSource="{Binding Patrocinadores}"
                                   IsVisible="{Binding IsNotLoading}"
                                   SelectionMode="None"
                                   Margin="8,0">

                        <CollectionView.ItemsLayout>
                            <GridItemsLayout Orientation="Vertical"
                                           Span="2"
                                           HorizontalItemSpacing="8"
                                           VerticalItemSpacing="8" />
                        </CollectionView.ItemsLayout>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Style="{StaticResource PatrocinadorCard}"
                                       HeightRequest="220">

                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnPatrocinadorTapped" />
                                    </Frame.GestureRecognizers>

                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="120" />
                                            <RowDefinition Height="*" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!-- Imagen del patrocinador -->
                                        <Border Grid.Row="0"
                                               BackgroundColor="#F5F5F5"
                                               StrokeThickness="0">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="20,20,0,0" />
                                            </Border.StrokeShape>

                                            <!-- Imagen real del patrocinador -->
                                            <Image Source="{Binding Imagen}"
                                                  Aspect="AspectFill"
                                                  IsVisible="{Binding Imagen, Converter={StaticResource IsNullConverter}, ConverterParameter='inverse'}"
                                                  BackgroundColor="Transparent" />

                                            <!-- Placeholder cuando no hay imagen -->
                                            <Grid IsVisible="{Binding Imagen, Converter={StaticResource IsNullConverter}}"
                                                  BackgroundColor="{StaticResource SoftBlueGradient}">
                                                <Label Text="ðŸ¢"
                                                      FontSize="40"
                                                      HorizontalOptions="Center"
                                                      VerticalOptions="Center"
                                                      TextColor="#1976D2" />
                                            </Grid>
                                        </Border>

                                        <!-- Contenido de la tarjeta -->
                                        <StackLayout Grid.Row="1"
                                                    Padding="12,8">

                                            <Label Text="{Binding Nombre}"
                                                  FontSize="16"
                                                  FontAttributes="Bold"
                                                  TextColor="#1976D2"
                                                  LineBreakMode="TailTruncation"
                                                  MaxLines="2"
                                                  HorizontalTextAlignment="Center" />

                                            <Label Text="{Binding Direccion}"
                                                  FontSize="12"
                                                  TextColor="#666"
                                                  LineBreakMode="TailTruncation"
                                                  MaxLines="2"
                                                  HorizontalTextAlignment="Center"
                                                  Margin="0,4,0,0"
                                                  IsVisible="{Binding Direccion, Converter={StaticResource IsNullConverter}, ConverterParameter='inverse'}" />
                                        </StackLayout>

                                        <!-- Icono de ubicaciÃ³n -->
                                        <Border Grid.Row="2"
                                               BackgroundColor="#2196F3"
                                               Padding="8,6"
                                               Margin="12,0,12,12">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="15" />
                                            </Border.StrokeShape>

                                            <StackLayout Orientation="Horizontal"
                                                        HorizontalOptions="Center">
                                                <Label Text="ðŸ“"
                                                      FontSize="12"
                                                      VerticalOptions="Center" />
                                                <Label Text="Ver en mapa"
                                                      FontSize="12"
                                                      TextColor="White"
                                                      FontAttributes="Bold"
                                                      VerticalOptions="Center"
                                                      Margin="4,0,0,0" />
                                            </StackLayout>
                                        </Border>
                                    </Grid>

                                    <!-- Efectos visuales -->
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal">
                                                <VisualState.Setters>
                                                    <Setter Property="Scale" Value="1.0" />
                                                </VisualState.Setters>
                                            </VisualState>
                                            <VisualState x:Name="Selected">
                                                <VisualState.Setters>
                                                    <Setter Property="Scale" Value="0.95" />
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>

                        <CollectionView.EmptyView>
                            <StackLayout HorizontalOptions="CenterAndExpand"
                                        VerticalOptions="CenterAndExpand"
                                        Margin="40">

                                <Label Text="ðŸ“­"
                                      FontSize="64"
                                      HorizontalOptions="Center" />

                                <Label Text="No hay patrocinadores disponibles"
                                      FontSize="20"
                                      FontAttributes="Bold"
                                      TextColor="#666"
                                      HorizontalOptions="Center"
                                      HorizontalTextAlignment="Center"
                                      Margin="0,20,0,0" />

                                <Label Text="Toca 'Gestionar' o el botÃ³n + para agregar patrocinadores"
                                      FontSize="14"
                                      TextColor="#999"
                                      HorizontalOptions="Center"
                                      HorizontalTextAlignment="Center"
                                      Margin="0,10,0,0" />
                            </StackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </Grid>
            </ScrollView>
        </RefreshView>

        <!-- BotÃ³n flotante para agregar -->
        <Button Grid.Row="1"
                x:Name="BtnAdd"
                Text="+"
                Style="{StaticResource PrimaryButton}"
                WidthRequest="60"
                HeightRequest="60"
                CornerRadius="30"
                FontSize="30"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,20,30"
                Clicked="OnAgregarPatrocinadorClicked">
            <Button.Shadow>
                <Shadow Brush="Black"
                        Offset="0,6"
                        Radius="15"
                        Opacity="0.25" />
            </Button.Shadow>
        </Button>
    </Grid>
</ContentPage>